# üìã –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ê AR-–°–ï–†–í–ò–°–ê PhotoBooks Gallery

**–î–∞—Ç–∞:** 24 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–¶–µ–ª—å:** –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã AR-—Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ browser preview –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üéØ 1. –û–ë–©–ï–ï –û–ü–ò–°–ê–ù–ò–ï

**AR-—Å–µ—Ä–≤–∏—Å** ‚Äî —ç—Ç–æ **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å** –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ (AR), –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç **–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ** –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ backend'–∞. –°–æ–∑–¥–∞–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—è–∂—ë–ª—ã—Ö CPU-–∑–∞–¥–∞—á (MindAR –∫–æ–º–ø–∏–ª—è—Ü–∏—è 72+ —Å–µ–∫—É–Ω–¥) –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: pg-boss –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞–Ω–∏–π
- ‚úÖ **–û—Ç–¥–µ–ª—å–Ω–∞—è –ë–î**: PostgreSQL ar_db (–ø–æ—Ä—Ç 5434)
- ‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: MD5-—Ö–µ—à .mind —Ñ–∞–π–ª–æ–≤ (99% —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∫–æ–º–ø–∏–ª—è—Ü–∏–π)
- ‚úÖ **WebAR**: HTML5 viewer (A-Frame + MindAR) ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç **–±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
- ‚úÖ **QR-–∫–æ–¥—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ **Demo-—Ä–µ–∂–∏–º**: 24-—á–∞—Å–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã —Å –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ–º

---

## üèóÔ∏è 2. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         USER BROWSER                             ‚îÇ
‚îÇ  (React Frontend –Ω–∞ –ø–æ—Ä—Ç—É 3000/8080)                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚îú‚îÄ‚îÄ‚ñ∫ /api/ar/create-demo (upload photo+video)
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BACKEND API (–ø–æ—Ä—Ç 5002)                       ‚îÇ
‚îÇ  - Express.js + Drizzle ORM                                      ‚îÇ
‚îÇ  - –†–æ—É—Ç–µ—Ä: backend/src/routers/ar-router.ts                     ‚îÇ
‚îÇ  - –ö–ª–∏–µ–Ω—Ç: backend/src/services/ar-service-client.ts            ‚îÇ
‚îÇ  - –ë–î: photobooks_db (–ø–æ—Ä—Ç 5433) ‚Äî –∑–∞–∫–∞–∑—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚îÇ HTTP POST /compile
                    ‚îÇ { userId, photoUrl, videoUrl, config }
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               AR MICROSERVICE (–ø–æ—Ä—Ç 5000)                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Express API Routes:                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - POST /compile    ‚Üí –°–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–µ–∫—Ç, –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ queue  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - GET /status/:id  ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - GET /view/:id    ‚Üí HTML5 AR viewer                     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - GET /health      ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏          ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ pg-boss Queue Manager:                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - –û—á–µ—Ä–µ–¥—å: AR_COMPILE (teamSize: 2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö)        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - –û—á–µ—Ä–µ–¥—å: DEMO_CLEANUP (–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Retry logic: 3 –ø–æ–ø—ã—Ç–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Compiler Worker:                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  1. Resize photo: 4961px ‚Üí 1024px (5-8x –±—ã—Å—Ç—Ä–µ–µ)         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  2. Border enhancement: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ö–µ—à-–ø–∞—Ç—Ç–µ—Ä–Ω           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  3. Crop center: –£–±—Ä–∞—Ç—å —Ä–∞–º–∫—É –¥–ª—è MindAR                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  4. MD5 cache check: –ï—Å—Ç—å .mind? ‚Üí –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å (1—Å)       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  5. MindAR compile: .mind —Ñ–∞–π–ª (72—Å –ø–µ—Ä–≤—ã–π —Ä–∞–∑)          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  6. HTML viewer: A-Frame + MindAR.js                     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  7. QR code: ngrok/production URL                        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  8. Video copy: –ï—Å–ª–∏ –µ—Å—Ç—å                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  9. Logo copy: –ï—Å–ª–∏ –µ—Å—Ç—å                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  –ë–î: ar_db (PostgreSQL –ø–æ—Ä—Ç 5434)                                ‚îÇ
‚îÇ  Storage: /objects/ar-storage/:projectId/                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚îÇ –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        AR STORAGE (—Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)                             ‚îÇ
‚îÇ  /objects/ar-storage/{projectId}/                                ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ marker.mind (436 KB) ‚Üê –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Ä–∫–µ—Ä            ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ index.html (19 KB) ‚Üê HTML5 AR viewer                      ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ qr-code.png (8 KB) ‚Üê QR-–∫–æ–¥ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è             ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ video.mp4 (5-50 MB) ‚Üê –í–∏–¥–µ–æ –¥–ª—è AR                       ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ photo-resized.jpg (500 KB) ‚Üê –£–º–µ–Ω—å—à–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ            ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ enhanced-photo.jpg (2 MB) ‚Üê –° —Ä–∞–º–∫–æ–π                      ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ marker-for-mind.jpg (800 KB) ‚Üê –ë–µ–∑ —Ä–∞–º–∫–∏ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏  ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ logo_animate1.webp (optional)                             ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  /objects/ar-storage/mind-cache/                                 ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ {md5hash}.mind ‚Üê –ö–µ—à —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ 3. –¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –°–¢–ï–ö

### AR Microservice (`ar-service/`)
```json
{
  "runtime": "Node.js 20.17.0",
  "framework": "Express.js 4.18.2",
  "language": "TypeScript 5.3.3",
  "queue": "pg-boss 9.0.3",
  "database": "PostgreSQL 15 (ar_db)",
  "ar_engine": "mind-ar 1.2.5",
  "ml_backend": "@tensorflow/tfjs-node 4.22.0",
  "image_processing": "sharp 0.33.1 + canvas 2.11.2",
  "video_processing": "fluent-ffmpeg 2.1.2",
  "qr_generation": "qrcode 1.5.3"
}
```

### Backend Integration (`backend/`)
```json
{
  "ar_client": "backend/src/services/ar-service-client.ts",
  "ar_router": "backend/src/routers/ar-router.ts",
  "communication": "HTTP REST (fetch API)",
  "timeout": "300 seconds (5 minutes)",
  "retry": "None (AR service handles retries)"
}
```

### Frontend (`frontend/`)
```json
{
  "framework": "React + Vite",
  "pages": [
    "/living-photos ‚Üí LivingPhotos.tsx",
    "/ar/view/:id ‚Üí ARViewRedirect.tsx",
    "/admin/ar-edit ‚Üí AdminAREdit.tsx"
  ],
  "ar_viewer_access": "Direct URL (QR scan) ‚Üí /objects/ar-storage/{id}/index.html"
}
```

---

## üîÑ 4. DATA FLOW (–ü–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª AR-–ø—Ä–æ–µ–∫—Ç–∞)

### –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç AR-–ø—Ä–æ–µ–∫—Ç

```javascript
// Frontend: LivingPhotos.tsx
const formData = new FormData();
formData.append('photo', photoFile);
formData.append('video', videoFile);

const response = await fetch('/api/ar/create-demo', {
  method: 'POST',
  body: formData
});

const { data } = await response.json();
// data = { arId: 'demo-123-abc', status: 'pending', statusUrl: '/api/ar/status/demo-123-abc' }
```

### –®–∞–≥ 2: Backend –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å

```typescript
// backend/src/routers/ar-router.ts
router.post('/create-demo', requireAuth, upload.fields([...]), async (req, res) => {
  // 1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª—ã –≤ /objects/uploads/
  const photoPath = `/objects/uploads/demo-${timestamp}-photo.jpg`;
  const videoPath = `/objects/uploads/demo-${timestamp}-video.mp4`;
  
  // 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ AR microservice
  const result = await requestARCompilation({
    userId: req.user.id,
    photoUrl: photoPath,
    videoUrl: videoPath,
    isDemo: true
  });
  
  // 3. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 202 Accepted
  res.status(202).json({
    arId: result.projectId,
    status: 'pending',
    statusUrl: `/api/ar/status/${result.projectId}`
  });
});
```

### –®–∞–≥ 3: AR Microservice –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å

```typescript
// ar-service/src/routes/compile.ts
router.post('/compile', async (req, res) => {
  const projectId = uuidv4();
  
  // 1. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ ar_projects
  await pool.query(`
    INSERT INTO ar_projects (id, user_id, photo_url, video_url, status, is_demo, expires_at)
    VALUES ($1, $2, $3, $4, 'queued', true, NOW() + INTERVAL '24 hours')
  `, [projectId, userId, photoUrl, videoUrl]);
  
  // 2. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –≤ pg-boss
  const jobId = await boss.send('AR_COMPILE', {
    projectId,
    photoPath: resolveFilePath(photoUrl),
    videoPath: resolveFilePath(videoUrl),
    storageDir: `/app/storage/ar-storage/${projectId}`,
    config: req.body.config || {}
  });
  
  // 3. –í–µ—Ä–Ω—É—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–Ω–µ –∂–¥–∞—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏–∏!)
  res.status(202).json({
    projectId,
    status: 'queued',
    estimatedTimeSeconds: 120
  });
});
```

### –®–∞–≥ 4: pg-boss Worker –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç AR

```typescript
// ar-service/src/workers/compiler-worker.ts
await boss.work('AR_COMPILE', { teamSize: 2 }, async (job) => {
  const { projectId, photoPath, videoPath, storageDir, config } = job.data;
  
  // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å: processing
  await updateProjectStatus(projectId, 'processing');
  
  // ============ –ö–û–ú–ü–ò–õ–Ø–¶–ò–Ø ============
  const result = await compileARProject({
    projectId,
    photoPath,    // /app/objects/uploads/demo-123-photo.jpg
    videoPath,    // /app/objects/uploads/demo-123-video.mp4
    storageDir,   // /app/storage/ar-storage/demo-123-abc
    config
  });
  
  if (result.success) {
    // –û–±–Ω–æ–≤–∏—Ç—å –ë–î —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    await pool.query(`
      UPDATE ar_projects
      SET status = 'ready',
          marker_mind_url = '/objects/ar-storage/${projectId}/marker.mind',
          viewer_html_url = '/objects/ar-storage/${projectId}/index.html',
          qr_code_url = '/objects/ar-storage/${projectId}/qr-code.png',
          view_url = '${TUNNEL_URL}/ar/view/${projectId}',
          compilation_time_ms = $1,
          compilation_finished_at = NOW()
      WHERE id = $2
    `, [result.compilationTimeMs, projectId]);
  } else {
    await updateProjectStatus(projectId, 'error', result.error);
  }
});
```

### –®–∞–≥ 5: Frontend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å (polling)

```typescript
// frontend/src/pages/LivingPhotos.tsx
const pollStatus = async () => {
  const response = await fetch(`/api/ar/status/${arId}`);
  const { data } = await response.json();
  
  if (data.status === 'ready') {
    setQrCodeUrl(data.qrCodeUrl);
    setViewUrl(data.viewUrl);
    stopPolling();
  } else if (data.status === 'error') {
    showError(data.error);
    stopPolling();
  }
};

// –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
const interval = setInterval(pollStatus, 5000);
```

### –®–∞–≥ 6: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR-–∫–æ–¥

```
QR Code —Å–æ–¥–µ—Ä–∂–∏—Ç: https://photobooksgallery.am/ar/view/demo-123-abc
                           ‚Üì
         –ë—Ä–∞—É–∑–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç AR viewer
                           ‚Üì
/objects/ar-storage/demo-123-abc/index.html (WebAR)
```

### –®–∞–≥ 7: AR Viewer —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ

```html
<!-- /objects/ar-storage/demo-123-abc/index.html -->
<a-scene mindar-image="imageTargetSrc:./marker.mind">
  <a-assets>
    <video id="vid" src="./video.mp4" loop muted playsinline></video>
  </a-assets>
  
  <a-camera></a-camera>
  
  <a-entity mindar-image-target="targetIndex:0">
    <a-plane material="src:#vid" width="1" height="0.75"></a-plane>
  </a-entity>
</a-scene>

<script>
// 1. MindAR –∑–∞–≥—Ä—É–∂–∞–µ—Ç marker.mind (436 KB)
// 2. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
// 3. –ö–æ–≥–¥–∞ –≤–∏–¥–∏—Ç —Ñ–æ—Ç–æ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ –ø–æ–≤–µ—Ä—Ö –Ω–µ–≥–æ
// 4. –†–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!
</script>
```

---

## üóÑÔ∏è 5. –ë–ê–ó–ê –î–ê–ù–ù–´–•

### ar_db (PostgreSQL –Ω–∞ –ø–æ—Ä—Ç—É 5434)

**–¢–∞–±–ª–∏—Ü–∞: `ar_projects`**
```sql
id               VARCHAR(255) PRIMARY KEY  -- demo-1763981287240-9ydtkf1
user_id          VARCHAR(255)              -- –°—Å—ã–ª–∫–∞ –Ω–∞ users.id –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î
order_id         VARCHAR(255)              -- NULL –¥–ª—è demo-–ø—Ä–æ–µ–∫—Ç–æ–≤
photo_url        VARCHAR(500)              -- /objects/uploads/photo.jpg
video_url        VARCHAR(500)              -- /objects/uploads/video.mp4 (optional)
marker_mind_url  VARCHAR(500)              -- /ar-storage/{id}/marker.mind
viewer_html_url  VARCHAR(500)              -- /ar-storage/{id}/index.html
qr_code_url      VARCHAR(500)              -- /ar-storage/{id}/qr-code.png
view_url         VARCHAR(500)              -- https://...ngrok.../ar/view/{id}
status           VARCHAR(50)               -- pending/queued/processing/ready/error
queue_job_id     VARCHAR(255)              -- pg-boss job ID
compilation_time_ms  INTEGER               -- 72000 (72 —Å–µ–∫—É–Ω–¥—ã)
is_demo          BOOLEAN                   -- true = –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 24—á
expires_at       TIMESTAMP                 -- 2025-11-25 10:44:15
config           JSONB                     -- {fitMode, zoom, offsetX, offsetY, ...}
created_at       TIMESTAMP
updated_at       TIMESTAMP
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
- `idx_ar_projects_user_id` ‚Äî –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `idx_ar_projects_status` ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É (pending/ready)
- `idx_ar_projects_demo_expires` ‚Äî –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ demo-–ø—Ä–æ–µ–∫—Ç–æ–≤

**–ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î:**
- ‚ùå **–ù–ï–¢ foreign keys** –∫ `photobooks_db`
- ‚úÖ **Eventual consistency** —á–µ—Ä–µ–∑ webhooks (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üîó 6. –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –û–°–ù–û–í–ù–´–ú –°–ê–ô–¢–û–ú

### Backend ‚Üê ‚Üí AR Service

**–§–∞–π–ª:** `backend/src/services/ar-service-client.ts`

```typescript
const AR_SERVICE_URL = process.env.AR_SERVICE_URL || 'http://localhost:5000';

// 1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏—é
export async function requestARCompilation(request: CompileRequest) {
  const response = await fetch(`${AR_SERVICE_URL}/compile`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(request),
    signal: AbortSignal.timeout(300000) // 5 –º–∏–Ω—É—Ç
  });
  
  return await response.json(); // { projectId, status: 'pending' }
}

// 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
export async function getARStatus(projectId: string) {
  const response = await fetch(`${AR_SERVICE_URL}/status/${projectId}`);
  return await response.json(); // { status: 'ready', qrCodeUrl, viewUrl, ... }
}
```

**–§–∞–π–ª:** `backend/src/routers/ar-router.ts`

```typescript
// –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
router.get('/status/:projectId', async (req, res) => {
  const status = await getARStatus(req.params.projectId);
  res.json({ message: 'AR project status', data: status });
});
```

### Frontend ‚Üê ‚Üí Backend API

**–§–∞–π–ª:** `frontend/src/pages/LivingPhotos.tsx`

```typescript
// 1. –°–æ–∑–¥–∞—Ç—å AR-–ø—Ä–æ–µ–∫—Ç
const createAR = async () => {
  const formData = new FormData();
  formData.append('photo', photoFile);
  formData.append('video', videoFile);
  
  const response = await fetch('/api/ar/create-demo', {
    method: 'POST',
    body: formData
  });
  
  const { data } = await response.json();
  setArId(data.arId);
  startPolling(data.arId);
};

// 2. Polling —Å—Ç–∞—Ç—É—Å–∞
const checkStatus = async (arId: string) => {
  const response = await fetch(`/api/ar/status/${arId}`);
  const { data } = await response.json();
  
  if (data.status === 'ready') {
    setQrCode(data.qrCodeUrl);
    setViewUrl(data.viewUrl);
  }
};
```

### QR Code ‚Üí AR Viewer (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR:
  https://photobooksgallery.am/ar/view/demo-123-abc
         ‚Üì
Frontend —Ä–æ—É—Ç–µ—Ä: /ar/view/:id (ARViewRedirect.tsx)
         ‚Üì
–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞: /objects/ar-storage/demo-123-abc/index.html
         ‚Üì
–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π HTML —Ñ–∞–π–ª —Å A-Frame + MindAR
         ‚Üì
–ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ‚Üí —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —Ñ–æ—Ç–æ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** AR viewer —Ä–∞–±–æ—Ç–∞–µ—Ç **–ë–ï–ó React**, —ç—Ç–æ **—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π HTML** —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º JavaScript, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ**.

---

## ‚ö° 7. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚ùå –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: 1920px
- ‚ùå –ö–æ–º–ø–∏–ª—è—Ü–∏—è: **174 —Å–µ–∫—É–Ω–¥—ã**
- ‚ùå –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è: 174 —Å–µ–∫—É–Ω–¥—ã (–±–µ–∑ –∫–µ—à–∞)
- ‚ùå –†–∞–∑–º–µ—Ä .mind: 581 KB

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è):
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: **1024px** (5-8x –±—ã—Å—Ç—Ä–µ–µ)
- ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è: **72 —Å–µ–∫—É–Ω–¥—ã** (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è: **1 —Å–µ–∫—É–Ω–¥–∞** (MD5 –∫–µ—à)
- ‚úÖ –†–∞–∑–º–µ—Ä .mind: **436 KB** (25% –º–µ–Ω—å—à–µ)

### MD5 Cache Logic:
```typescript
// ar-service/src/workers/ar-compiler-core.ts
const photoBuffer = await fs.readFile(finalMarkerSourcePath);
const photoHash = crypto.createHash('md5').update(photoBuffer).digest('hex');
const cachedMindPath = path.join(cacheDir, `${photoHash}.mind`);

if (await fs.access(cachedMindPath)) {
  // CACHE HIT! –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞ 1 —Å–µ–∫—É–Ω–¥—É
  await fs.copyFile(cachedMindPath, targetMindPath);
  console.log('‚ö° Compilation skipped (cached)');
} else {
  // CACHE MISS. –ö–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å 72s –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–µ—à
  const mindFile = await compileMindFile(...);
  await fs.copyFile(mindFile, cachedMindPath);
}
```

### pg-boss Queue Configuration:
```typescript
await boss.work('AR_COMPILE', {
  teamSize: 2,           // 2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö worker'–∞
  teamConcurrency: 1,    // 1 –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ worker (–∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ CPU)
  retryLimit: 3,         // 3 –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
  retryDelay: 60,        // 60 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
  retryBackoff: true     // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (60s, 120s, 240s)
}, handleCompileJob);
```

---

## üì± 8. BROWSER AR VIEWER (WebAR)

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- **A-Frame 1.4.2** ‚Äî –§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è WebVR/WebAR
- **MindAR 1.2.5** ‚Äî Image tracking –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **TensorFlow.js** ‚Äî ML backend –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤
- **getUserMedia API** ‚Äî –î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç viewer:

```html
<!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ ar-compiler-core.ts —Ñ—É–Ω–∫—Ü–∏–µ–π generateARViewer() -->
<!DOCTYPE html>
<html>
<head>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
  <!-- Loading screen —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π -->
  <div class="arjs-loader" id="loading">
    <img src="./logo_animate1.webp" alt="Loading">
    <div>–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –≤–æ–ª—à–µ–±—Å—Ç–≤—É</div>
  </div>
  
  <!-- Instructions -->
  <div id="instructions">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</div>
  
  <!-- A-Frame —Å—Ü–µ–Ω–∞ -->
  <a-scene 
    embedded
    mindar-image="imageTargetSrc:./marker.mind;maxTrack:1"
    renderer="colorManagement:true;antialias:true">
    
    <!-- –í–∏–¥–µ–æ –∫–∞–∫ asset -->
    <a-assets>
      <video id="vid" src="./video.mp4" loop muted playsinline></video>
    </a-assets>
    
    <!-- –ö–∞–º–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>
    
    <!-- AR –ø–ª–æ—Å–∫–æ—Å—Ç—å —Å –≤–∏–¥–µ–æ -->
    <a-entity mindar-image-target="targetIndex:0">
      <a-plane 
        material="src:#vid"
        width="1"
        height="0.75"
        position="0 0 0"
        visible="false">
      </a-plane>
    </a-entity>
  </a-scene>
  
  <script>
    // JavaScript –ª–æ–≥–∏–∫–∞:
    const video = document.getElementById('vid');
    const plane = document.querySelector('a-plane');
    const target = document.querySelector('[mindar-image-target]');
    
    // 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å marker.mind (–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Ä–∫–µ—Ä)
    // 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É
    // 3. –°–ª—É—à–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ targetFound
    target.addEventListener('targetFound', () => {
      console.log('–ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω!');
      plane.setAttribute('visible', 'true');
      video.play();
    });
    
    // 4. –°–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ –∫–æ–≥–¥–∞ –º–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω
    target.addEventListener('targetLost', () => {
      console.log('–ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
      plane.setAttribute('visible', 'false');
      video.pause();
    });
  </script>
</body>
</html>
```

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤:
- ‚úÖ **iOS Safari** 11+ (iPhone/iPad)
- ‚úÖ **Chrome Android** 80+
- ‚úÖ **Samsung Internet**
- ‚úÖ **Firefox Android**
- ‚ö†Ô∏è **Desktop** (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–µ–±-–∫–∞–º–µ—Ä–æ–π, –Ω–æ –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)

### –ë–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç App Store/Google Play
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ QR-–∫–æ–¥—É
- ‚úÖ –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å (iOS + Android)

---

## üîê 9. –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ò–ó–û–õ–Ø–¶–ò–Ø

### –ò–∑–æ–ª—è—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞:
```yaml
# docker-compose.yml
ar-service:
  container_name: photobooks-ar-service
  ports:
    - "5000:5000"
  networks:
    - internal  # –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ç—å
  environment:
    AR_DATABASE_URL: postgresql://photobooks:...@ar-db:5432/ar_db
  volumes:
    - ./backend/objects:/app/objects  # Shared storage
```

### –û–±—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤:
```
/backend/objects/
  ‚îú‚îÄ‚îÄ uploads/         ‚Üê Backend —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏
  ‚îî‚îÄ‚îÄ ar-storage/      ‚Üê AR service –ø–∏—à–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      ‚îú‚îÄ‚îÄ {projectId}/
      ‚îÇ   ‚îú‚îÄ‚îÄ marker.mind
      ‚îÇ   ‚îú‚îÄ‚îÄ index.html
      ‚îÇ   ‚îú‚îÄ‚îÄ qr-code.png
      ‚îÇ   ‚îî‚îÄ‚îÄ video.mp4
      ‚îî‚îÄ‚îÄ mind-cache/
          ‚îî‚îÄ‚îÄ {md5hash}.mind
```

### Eventual Consistency:
- **–ù–ï–¢** –ø—Ä—è–º—ã—Ö foreign keys –º–µ–∂–¥—É `ar_db` –∏ `photobooks_db`
- –°–≤—è–∑—å —á–µ—Ä–µ–∑ `user_id` –∏ `order_id` (—Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã)
- Webhooks (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π

---

## üìä 10. –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

### Healthcheck:
```bash
curl http://localhost:5000/health
```

**Response:**
```json
{
  "status": "healthy",
  "service": "ar-microservice",
  "version": "1.0.0",
  "timestamp": "2025-11-24T10:42:54.654Z",
  "database": "connected",
  "queue": "ok",
  "uptime": 42.5
}
```

### Compilation logs:
```typescript
// ar-service/src/workers/ar-compiler-core.ts
console.log('[AR Core] üìê Resizing large photo 4961x4961px ‚Üí max 1024px');
console.log('[AR Core] ‚úÖ Resized to 1920x1920px');
console.log('[AR Core] üé® Enhanced with border (Seed: 711c2f2b)');
console.log('[AR Core] ‚è≥ STEP 4: Compiling .mind marker...');
console.log('[AR Core] ‚úÖ MindAR SUCCESS! Time: 72.0s');
console.log('[AR Core] ‚úÖ‚úÖ‚úÖ COMPILATION COMPLETED in 75.3s ‚úÖ‚úÖ‚úÖ');
```

### Database tracking:
```sql
-- –¢–∞–±–ª–∏—Ü–∞ ar_compilation_logs
INSERT INTO ar_compilation_logs (project_id, step, status, duration_ms)
VALUES ('demo-123-abc', 'resize', 'completed', 3000);

INSERT INTO ar_compilation_logs (project_id, step, status, duration_ms)
VALUES ('demo-123-abc', 'compile', 'completed', 72000);
```

---

## üöÄ 11. –î–ï–ü–õ–û–ô –ò –û–ö–†–£–ñ–ï–ù–ò–Ø

### Development (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):
```bash
# AR Service
cd ar-service
npm run dev  # tsx watch src/index.ts (–ø–æ—Ä—Ç 5000)

# Backend
cd backend
npm run dev  # tsx watch src/index.ts (–ø–æ—Ä—Ç 5002)

# Frontend
cd frontend
npm run dev  # vite (–ø–æ—Ä—Ç 3000)
```

### Production (Docker):
```yaml
# docker-compose.yml
services:
  ar-db:
    image: postgres:15-alpine
    ports:
      - "5434:5432"
  
  ar-service:
    build: ./ar-service
    ports:
      - "5000:5000"
    depends_on:
      - ar-db
    environment:
      AR_DATABASE_URL: postgresql://photobooks:...@ar-db:5432/ar_db
      TUNNEL_URL: https://photobooksgallery.am
      ENABLE_WEBHOOKS: true
```

### Environment variables:
```bash
# ar-service/.env
NODE_ENV=production
PORT=5000
AR_DATABASE_URL=postgresql://photobooks:SecurePassword2025@ar-db:5432/ar_db
TUNNEL_URL=https://photobooksgallery.am
FRONTEND_URL=https://photobooksgallery.am
ENABLE_WEBHOOKS=false
AR_ENABLE_BORDER_ENHANCER=true
```

---

## üéØ 12. –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´ –î–õ–Ø –ü–†–û–ú–ü–¢–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### –ß—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:

1. **AR —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** ‚Äî —ç—Ç–æ WebAR (HTML5 + JavaScript)
2. **QR-–∫–æ–¥ –≤–µ–¥—ë—Ç –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π HTML** ‚Äî `/objects/ar-storage/{id}/index.html`
3. **Viewer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç A-Frame + MindAR** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
4. **–ú–∞—Ä–∫–µ—Ä = –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π .mind —Ñ–∞–π–ª** (436 KB) ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä
5. **–ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** ‚Äî getUserMedia API
6. **–í–∏–¥–µ–æ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö —Ñ–æ—Ç–æ** ‚Äî –∫–æ–≥–¥–∞ MindAR —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –º–∞—Ä–∫–µ—Ä
7. **–ò–∑–æ–ª—è—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞** ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –ë–î, –æ—á–µ—Ä–µ–¥—å, storage
8. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è** ‚Äî pg-boss + worker threads
9. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî MD5 —Ö–µ—à –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∫–æ–º–ø–∏–ª—è—Ü–∏–π
10. **Demo-—Ä–µ–∂–∏–º** ‚Äî –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞

### –ü—Ä–æ–±–ª–µ–º–∞ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º preview:

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- QR-–∫–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å production URL (ngrok/photobooksgallery.am)
- HTML viewer —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ (`./marker.mind`, `./video.mp4`)
- –†–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** –ø—Ä–∏ –ø—Ä—è–º–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ storage

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è preview:**
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ AR** –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ desktop
- –≠–º—É–ª—è—Ü–∏—è –∫–∞–º–µ—Ä—ã –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è-–º–∞—Ä–∫–µ—Ä–∞
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ viewer'–∞ –≤ iframe/–æ–∫–Ω–µ –∞–¥–º–∏–Ω–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ, WebSocket –¥–ª—è live-updates –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## üìù 13. –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í –ü–†–û–ï–ö–¢–ê

### AR Service Structure:
```
ar-service/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts                    # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (Express server)
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.ts            # PostgreSQL pool (ar_db)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ queue.ts               # pg-boss configuration
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ compile.ts             # POST /compile (—Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ status.ts              # GET /status/:id (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ viewer.ts              # GET /view/:id (HTML viewer)
‚îÇ   ‚îú‚îÄ‚îÄ workers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ compiler-worker.ts     # Worker thread manager
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ar-compiler-core.ts    # MindAR compilation logic
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhook-client.ts      # Webhooks –∫ backend
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ file-manager.ts        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îî‚îÄ‚îÄ 001_initial_schema.sql # Database schema
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ .env

Backend Integration:
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ar-router.ts           # /api/ar/* endpoints
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ar-service-client.ts   # HTTP client –¥–ª—è AR service
‚îÇ   ‚îî‚îÄ‚îÄ objects/
‚îÇ       ‚îú‚îÄ‚îÄ uploads/                # –ó–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ       ‚îî‚îÄ‚îÄ ar-storage/             # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
‚îÇ           ‚îú‚îÄ‚îÄ {projectId}/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ marker.mind
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ qr-code.png
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ video.mp4
‚îÇ           ‚îî‚îÄ‚îÄ mind-cache/
‚îÇ               ‚îî‚îÄ‚îÄ {md5hash}.mind

Frontend Integration:
frontend/
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ pages/
    ‚îÇ   ‚îú‚îÄ‚îÄ LivingPhotos.tsx       # –°–æ–∑–¥–∞–Ω–∏–µ AR-–ø—Ä–æ–µ–∫—Ç–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ ARViewRedirect.tsx     # –†–µ–¥–∏—Ä–µ–∫—Ç /ar/view/:id
    ‚îÇ   ‚îî‚îÄ‚îÄ AdminAREdit.tsx        # –ê–¥–º–∏–Ω–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îî‚îÄ‚îÄ components/
        ‚îî‚îÄ‚îÄ ar/
            ‚îî‚îÄ‚îÄ ARProjectItemsList.tsx
```

---

## üìã 14. API ENDPOINTS

### AR Microservice (–ø–æ—Ä—Ç 5000)

**1. POST /compile**
```typescript
// Request
{
  "userId": "user-123",
  "photoUrl": "/objects/uploads/photo.jpg",
  "videoUrl": "/objects/uploads/video.mp4",  // optional
  "orderId": "order-456",                     // optional
  "isDemo": true,
  "config": {
    "fitMode": "contain",
    "zoom": 1.0,
    "offsetX": 0,
    "offsetY": 0,
    "aspectLocked": true,
    "autoPlay": true,
    "loop": true
  }
}

// Response (202 Accepted)
{
  "projectId": "demo-1763981287240-9ydtkf1",
  "status": "queued",
  "message": "Compilation job queued",
  "estimatedTimeSeconds": 120,
  "statusUrl": "/status/demo-1763981287240-9ydtkf1",
  "viewUrl": "/view/demo-1763981287240-9ydtkf1"
}
```

**2. GET /status/:projectId**
```typescript
// Response
{
  "projectId": "demo-1763981287240-9ydtkf1",
  "status": "ready",  // pending/queued/processing/ready/error
  "progress": 100,
  "viewUrl": "https://photobooksgallery.am/ar/view/demo-1763981287240-9ydtkf1",
  "qrCodeUrl": "/objects/ar-storage/demo-1763981287240-9ydtkf1/qr-code.png",
  "markerMindUrl": "/objects/ar-storage/demo-1763981287240-9ydtkf1/marker.mind",
  "compilationTimeMs": 72275,
  "isDemo": true,
  "expiresAt": "2025-11-25T10:44:15.225Z",
  "createdAt": "2025-11-24T06:44:15.227Z",
  "updatedAt": "2025-11-24T06:45:45.442Z"
}
```

**3. GET /view/:projectId**
```html
<!-- Returns HTML file -->
<!DOCTYPE html>
<html>
  <!-- Full AR viewer with A-Frame + MindAR -->
</html>
```

**4. GET /health**
```json
{
  "status": "healthy",
  "service": "ar-microservice",
  "version": "1.0.0",
  "database": "connected",
  "queue": "ok",
  "uptime": 3600.5
}
```

### Backend API (–ø–æ—Ä—Ç 5002)

**1. POST /api/ar/create-demo**
```typescript
// Request (multipart/form-data)
FormData {
  photo: File (image/jpeg)
  video: File (video/mp4)
}

// Response (202 Accepted)
{
  "message": "Demo AR project created (expires in 24 hours)",
  "data": {
    "arId": "demo-1763981287240-9ydtkf1",
    "status": "pending",
    "expiresAt": "2025-11-25T10:44:15.225Z",
    "isDemo": true,
    "estimatedTimeSeconds": 120,
    "statusUrl": "/api/ar/status/demo-1763981287240-9ydtkf1"
  }
}
```

**2. GET /api/ar/status/:projectId**
```typescript
// Response
{
  "message": "AR project status",
  "data": {
    "id": "demo-1763981287240-9ydtkf1",
    "status": "ready",
    "progress": 100,
    "viewUrl": "https://photobooksgallery.am/ar/view/...",
    "qrCodeUrl": "/objects/ar-storage/.../qr-code.png",
    "markerMindUrl": "/objects/ar-storage/.../marker.mind",
    "compilationTimeMs": 72275,
    "isDemo": true,
    "expiresAt": "2025-11-25T10:44:15.225Z"
  }
}
```

---

## üîÑ 15. COMPILATION WORKFLOW (–¥–µ—Ç–∞–ª—å–Ω–æ)

### –≠—Ç–∞–ø 1: Resize Photo (3 —Å–µ–∫—É–Ω–¥—ã)
```typescript
// Input:  /uploads/photo.jpg (4961x4961px, 5 MB)
// Output: /ar-storage/{id}/photo-resized.jpg (1024x1024px, 500 KB)

await sharp(photoPath)
  .resize(1024, 1024, { fit: 'inside', withoutEnlargement: true })
  .jpeg({ quality: 90 })
  .toFile(resizedPath);
```

### –≠—Ç–∞–ø 2: Border Enhancement (7 —Å–µ–∫—É–Ω–¥)
```typescript
// Input:  photo-resized.jpg (1024x1024px)
// Output: enhanced-photo.jpg (1305x1305px —Å —Ä–∞–º–∫–æ–π)

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ MD5 —Ö–µ—à–∞ —Ñ–æ—Ç–æ
const seed = generatePhotoSeed(photoPath);
const rng = new SeededRandom(seed);
const borderThickness = Math.round(maxSide * 0.135); // 13.5%

// Canvas: —Ä–∏—Å—É–µ–º —Ä–∞–º–∫—É —Å –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º
const canvas = createCanvas(origW + borderThickness * 2, origH + borderThickness * 2);
drawUniqueBorder(ctx, borderThickness, rng);
ctx.drawImage(originalPhoto, borderThickness, borderThickness);
```

### –≠—Ç–∞–ø 3: Crop Center (2 —Å–µ–∫—É–Ω–¥—ã)
```typescript
// Input:  enhanced-photo.jpg (1305x1305px —Å —Ä–∞–º–∫–æ–π)
// Output: marker-for-mind.jpg (1024x1024px –±–µ–∑ —Ä–∞–º–∫–∏)

// –í—ã—Ä–µ–∑–∞—Ç—å —Ü–µ–Ω—Ç—Ä (—É–±—Ä–∞—Ç—å —Ä–∞–º–∫—É) –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è MindAR
await sharp(enhancedPhotoPath)
  .extract({
    left: borderThickness,
    top: borderThickness,
    width: origW,
    height: origH
  })
  .jpeg({ quality: 95 })
  .toFile(croppedPath);
```

### –≠—Ç–∞–ø 4: MD5 Cache Check (0.1 —Å–µ–∫—É–Ω–¥—ã)
```typescript
// –í—ã—á–∏—Å–ª–∏—Ç—å MD5 —Ö–µ—à —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
const photoBuffer = await fs.readFile(markerPath);
const photoHash = crypto.createHash('md5').update(photoBuffer).digest('hex');
// photoHash = "5fdb97bea087c2756b7a3d2de32b4531"

const cachedMindPath = `/ar-storage/mind-cache/${photoHash}.mind`;

if (await fs.access(cachedMindPath)) {
  // CACHE HIT! –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π .mind —Ñ–∞–π–ª
  await fs.copyFile(cachedMindPath, targetMindPath);
  console.log('‚ö° Compilation skipped (1 second)');
  return { success: true, compilationTimeMs: 1000 };
}
```

### –≠—Ç–∞–ø 5: MindAR Compilation (72 —Å–µ–∫—É–Ω–¥—ã - –µ—Å–ª–∏ –Ω–µ—Ç –∫–µ—à–∞)
```typescript
// Input:  marker-for-mind.jpg (1024x1024px)
// Output: marker.mind (436 KB –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª)

// –ó–∞–≥—Ä—É–∑–∏—Ç—å TensorFlow.js
await tf.ready();

// –ó–∞–≥—Ä—É–∑–∏—Ç—å MindAR compiler
const { Compiler } = await import('mind-ar/src/image-target/offline-compiler.js');
const compiler = new Compiler({ maxScale: 640 });

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞
const image = await loadImage(markerPath);

// –ö–æ–º–ø–∏–ª—è—Ü–∏—è (CPU-intensive!)
await compiler.compileImageTargets([image], (progress) => {
  console.log(`MindAR compilation progress: ${progress.toFixed(1)}%`);
});

// –≠–∫—Å–ø–æ—Ä—Ç –±–∏–Ω–∞—Ä–Ω–æ–≥–æ .mind —Ñ–∞–π–ª–∞
const exportedBuffer = compiler.exportData();
await fs.writeFile('/ar-storage/{id}/marker.mind', exportedBuffer);

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–µ—à –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
await fs.copyFile(mindFilePath, `/ar-storage/mind-cache/${photoHash}.mind`);
```

### –≠—Ç–∞–ø 6: HTML Viewer Generation (1 —Å–µ–∫—É–Ω–¥–∞)
```typescript
// Input:  marker.mind, video.mp4, config
// Output: index.html (19 KB)

const html = `<!DOCTYPE html>
<html>
<head>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
  <a-scene mindar-image="imageTargetSrc:./marker.mind">
    <a-assets>
      <video id="vid" src="./video.mp4" loop muted playsinline></video>
    </a-assets>
    <a-camera></a-camera>
    <a-entity mindar-image-target="targetIndex:0">
      <a-plane material="src:#vid" width="${videoScale.width}" height="${videoScale.height}"></a-plane>
    </a-entity>
  </a-scene>
  <script>
    // AR tracking logic
  </script>
</body>
</html>`;

await fs.writeFile('/ar-storage/{id}/index.html', html);
```

### –≠—Ç–∞–ø 7: QR Code Generation (1 —Å–µ–∫—É–Ω–¥–∞)
```typescript
// Input:  projectId, TUNNEL_URL
// Output: qr-code.png (8 KB)

const viewUrl = `${TUNNEL_URL}/ar/view/${projectId}`;
// viewUrl = "https://photobooksgallery.am/ar/view/demo-123-abc"

await QRCode.toFile('/ar-storage/{id}/qr-code.png', viewUrl, {
  type: 'png',
  width: 512,
  margin: 2,
  color: {
    dark: '#000000',
    light: '#FFFFFF'
  }
});
```

### –≠—Ç–∞–ø 8: Copy Assets (3 —Å–µ–∫—É–Ω–¥—ã)
```typescript
// –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ
await fs.copyFile(
  '/objects/uploads/video.mp4',
  '/ar-storage/{id}/video.mp4'
);

// –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–æ—Ç–∏–ø (–µ—Å–ª–∏ –µ—Å—Ç—å)
await fs.copyFile(
  '/assets/logo_animate1.webp',
  '/ar-storage/{id}/logo_animate1.webp'
);
```

### –ò—Ç–æ–≥–æ:
```
Resize:             3s
Border Enhancement: 7s
Crop Center:        2s
MD5 Check:          0.1s
MindAR Compile:     72s (–∏–ª–∏ 1s –µ—Å–ª–∏ –∫–µ—à)
HTML Generation:    1s
QR Code:            1s
Copy Assets:        3s
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
TOTAL (–ø–µ—Ä–≤—ã–π —Ä–∞–∑): ~89s (—Å —É—á—ë—Ç–æ–º overhead)
TOTAL (—Å –∫–µ—à–µ–º):    ~17s
```

---

## üé® 16. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø AR VIEWER

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã config (JSONB –≤ –ë–î):

```typescript
interface ARConfig {
  // –†–µ–∂–∏–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ
  fitMode?: 'contain' | 'cover' | 'fill' | 'exact';
  
  // –ú–∞—Å—à—Ç–∞–± –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  zoom?: number;              // 1.0 = 100%, 1.5 = 150%
  offsetX?: number;           // –°–¥–≤–∏–≥ –ø–æ X (–≤ –º–µ—Ç—Ä–∞—Ö AR)
  offsetY?: number;           // –°–¥–≤–∏–≥ –ø–æ Y (–≤ –º–µ—Ç—Ä–∞—Ö AR)
  aspectLocked?: boolean;     // –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –ø—Ä–∏ zoom
  
  // –í–∏–¥–µ–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  autoPlay?: boolean;         // –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
  loop?: boolean;             // –ó–∞—Ü–∏–∫–ª–∏—Ç—å –≤–∏–¥–µ–æ
  
  // 3D –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  videoPosition?: {
    x: number;  // -1.0 to 1.0
    y: number;
    z: number;
  };
  
  videoRotation?: {
    x: number;  // –≥—Ä–∞–¥—É—Å—ã
    y: number;
    z: number;
  };
  
  videoScale?: {
    width: number;   // –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –º–∞—Ä–∫–µ—Ä–∞
    height: number;
  };
}
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```typescript
// –í–∞—Ä–∏–∞–Ω—Ç 1: –í–∏–¥–µ–æ —Ç–æ—á–Ω–æ –ø–æ —Ä–∞–∑–º–µ—Ä—É —Ñ–æ—Ç–æ (contain)
const config = {
  fitMode: 'contain',
  zoom: 1.0,
  autoPlay: true,
  loop: true
};

// –í–∞—Ä–∏–∞–Ω—Ç 2: –í–∏–¥–µ–æ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å—ë —Ñ–æ—Ç–æ (cover)
const config = {
  fitMode: 'cover',
  zoom: 1.2,
  aspectLocked: true,
  autoPlay: true,
  loop: true
};

// –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
const config = {
  fitMode: 'exact',
  videoPosition: { x: 0, y: 0.1, z: 0 },  // –°–¥–≤–∏–≥ –≤–≤–µ—Ä—Ö –Ω–∞ 0.1–º
  videoRotation: { x: 0, y: 0, z: 0 },
  videoScale: { width: 1.5, height: 1.125 },  // 4:3 —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ
  autoPlay: true,
  loop: true
};
```

---

## üìû 17. WEBHOOK –°–ò–°–¢–ï–ú–ê (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ Backend:

```typescript
// ar-service/src/services/webhook-client.ts

interface WebhookEvent {
  event_type: 'compilation_complete' | 'compilation_error' | 'demo_expired';
  project_id: string;
  payload: any;
}

export async function sendWebhook(event: WebhookEvent) {
  if (!process.env.ENABLE_WEBHOOKS) return;
  
  const webhookUrl = `${process.env.BACKEND_URL}/api/webhooks/ar`;
  
  try {
    await fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(event)
    });
    
    console.log(`[Webhook] ‚úÖ Sent: ${event.event_type}`);
  } catch (error) {
    console.error(`[Webhook] ‚ùå Failed:`, error);
    
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É ar_webhook_events –¥–ª—è retry
    await pool.query(`
      INSERT INTO ar_webhook_events (event_type, project_id, payload, attempts, next_retry_at)
      VALUES ($1, $2, $3, 0, NOW() + INTERVAL '1 minute')
    `, [event.event_type, event.project_id, event.payload]);
  }
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```typescript
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
await sendWebhook({
  event_type: 'compilation_complete',
  project_id: projectId,
  payload: {
    status: 'ready',
    compilation_time_ms: 72275,
    view_url: `https://photobooksgallery.am/ar/view/${projectId}`,
    qr_code_url: `/objects/ar-storage/${projectId}/qr-code.png`
  }
});
```

---

## üîç 18. DEBUGGING –ò TROUBLESHOOTING

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∑–∞–≤–∏—Å–ª–∞ –Ω–∞ 10%

**–ü—Ä–∏—á–∏–Ω–∞:** MindAR –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –Ω–µ—Ç –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞)

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å metadata —Ñ–æ—Ç–æ
const meta = await sharp(photoPath).metadata();
console.log('Photo metadata:', meta);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–æ—Ç–æ –Ω–µ —Ä–∞–∑–º—ã—Ç–æ (blur detection)
const stats = await sharp(photoPath).stats();
console.log('Image stats:', stats);
```

### –ü—Ä–æ–±–ª–µ–º–∞: AR –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ iPhone

**–ü—Ä–∏—á–∏–Ω–∞:** iOS Safari —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è getUserMedia API

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ngrok –¥–ª—è HTTPS tunnel
ngrok http 5000

# –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
# Let's Encrypt + Nginx reverse proxy
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í–∏–¥–µ–æ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** 
1. –í–∏–¥–µ–æ –Ω–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ H.264 (Safari —Ç—Ä–µ–±—É–µ—Ç)
2. –í–∏–¥–µ–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ (>50 MB)
3. CORS –æ—à–∏–±–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ H.264 —Å –ø–æ–º–æ—â—å—é ffmpeg
ffmpeg -i input.mp4 \
  -c:v libx264 \
  -profile:v baseline \
  -level 3.0 \
  -pix_fmt yuv420p \
  -movflags +faststart \
  output.mp4

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä
ls -lh output.mp4
```

### –ü—Ä–æ–±–ª–µ–º–∞: Port 5000 already in use

**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# Windows
netstat -ano | findstr :5000
taskkill /PID {PID} /F

# –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å graceful shutdown –≤ index.ts
process.on('SIGTERM', async () => {
  await server.close();
  await boss.stop();
  await pool.end();
  process.exit(0);
});
```

---

## üìö 19. –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- **MindAR:** https://github.com/hiukim/mind-ar-js
- **A-Frame:** https://aframe.io/docs/
- **TensorFlow.js:** https://www.tensorflow.org/js
- **pg-boss:** https://github.com/timgit/pg-boss

### –ü—Ä–∏–º–µ—Ä—ã AR –ø—Ä–æ–µ–∫—Ç–æ–≤:
- **8th Wall:** https://www.8thwall.com/
- **AR.js:** https://github.com/AR-js-org/AR.js
- **Zappar:** https://www.zappar.com/

### Browser API:
- **getUserMedia:** https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia
- **WebGL:** https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API

---

## üìù 20. –ö–†–ê–¢–ö–ê–Ø –°–•–ï–ú–ê –î–õ–Ø –ü–†–û–ú–ü–¢–ê

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                  AR SERVICE ARCHITECTURE                       ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

–ú–ò–ö–†–û–°–ï–†–í–ò–° (–ø–æ—Ä—Ç 5000)
‚îú‚îÄ‚îÄ Express API
‚îÇ   ‚îú‚îÄ‚îÄ POST /compile ‚Üí –°–æ–∑–¥–∞—Ç—å AR –ø—Ä–æ–µ–∫—Ç
‚îÇ   ‚îú‚îÄ‚îÄ GET /status/:id ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
‚îÇ   ‚îî‚îÄ‚îÄ GET /view/:id ‚Üí HTML5 AR viewer
‚îú‚îÄ‚îÄ pg-boss Queue
‚îÇ   ‚îú‚îÄ‚îÄ AR_COMPILE (teamSize: 2)
‚îÇ   ‚îî‚îÄ‚îÄ DEMO_CLEANUP (–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)
‚îú‚îÄ‚îÄ Compiler Worker
‚îÇ   ‚îú‚îÄ‚îÄ 1. Resize: 4961px ‚Üí 1024px (3s)
‚îÇ   ‚îú‚îÄ‚îÄ 2. Border: –•–µ—à-–ø–∞—Ç—Ç–µ—Ä–Ω (7s)
‚îÇ   ‚îú‚îÄ‚îÄ 3. Crop: –£–±—Ä–∞—Ç—å —Ä–∞–º–∫—É (2s)
‚îÇ   ‚îú‚îÄ‚îÄ 4. Cache: MD5 –ø—Ä–æ–≤–µ—Ä–∫–∞ (0.1s)
‚îÇ   ‚îú‚îÄ‚îÄ 5. MindAR: –ö–æ–º–ø–∏–ª—è—Ü–∏—è .mind (72s –∏–ª–∏ 1s)
‚îÇ   ‚îú‚îÄ‚îÄ 6. HTML: A-Frame viewer (1s)
‚îÇ   ‚îú‚îÄ‚îÄ 7. QR: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ (1s)
‚îÇ   ‚îî‚îÄ‚îÄ 8. Assets: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (3s)
‚îî‚îÄ‚îÄ PostgreSQL ar_db (–ø–æ—Ä—Ç 5434)
    ‚îú‚îÄ‚îÄ ar_projects (–ø—Ä–æ–µ–∫—Ç—ã)
    ‚îú‚îÄ‚îÄ ar_compilation_logs (–ª–æ–≥–∏)
    ‚îî‚îÄ‚îÄ ar_webhook_events (webhooks)

STORAGE (/backend/objects/)
‚îú‚îÄ‚îÄ uploads/ ‚Üê –ó–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ demo-123-photo.jpg
‚îÇ   ‚îî‚îÄ‚îÄ demo-123-video.mp4
‚îî‚îÄ‚îÄ ar-storage/ ‚Üê –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
    ‚îú‚îÄ‚îÄ demo-123-abc/
    ‚îÇ   ‚îú‚îÄ‚îÄ marker.mind (436 KB)
    ‚îÇ   ‚îú‚îÄ‚îÄ index.html (19 KB)
    ‚îÇ   ‚îú‚îÄ‚îÄ qr-code.png (8 KB)
    ‚îÇ   ‚îú‚îÄ‚îÄ video.mp4 (5-50 MB)
    ‚îÇ   ‚îú‚îÄ‚îÄ photo-resized.jpg (500 KB)
    ‚îÇ   ‚îú‚îÄ‚îÄ enhanced-photo.jpg (2 MB)
    ‚îÇ   ‚îî‚îÄ‚îÄ marker-for-mind.jpg (800 KB)
    ‚îî‚îÄ‚îÄ mind-cache/
        ‚îî‚îÄ‚îÄ 5fdb97be...31.mind (–∫–µ—à)

–ò–ù–¢–ï–ì–†–ê–¶–ò–Ø
Backend (5002) ‚îÄ‚îÄHTTP‚îÄ‚îÄ> AR Service (5000)
     ‚Üì                          ‚Üì
  Drizzle ORM              pg-boss queue
     ‚Üì                          ‚Üì
photobooks_db (5433)        ar_db (5434)

Frontend (3000)
     ‚Üì
  /api/ar/create-demo (upload)
     ‚Üì
  /api/ar/status/:id (polling)
     ‚Üì
  /objects/ar-storage/:id/index.html (viewer)

WebAR VIEWER
QR Code ‚Üí –ë—Ä–∞—É–∑–µ—Ä ‚Üí index.html ‚Üí A-Frame + MindAR
                      ‚Üì
         getUserMedia() (–∫–∞–º–µ—Ä–∞)
                      ‚Üì
         marker.mind (436 KB)
                      ‚Üì
         –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ
                      ‚Üì
         –ü–æ–∫–∞–∑–∞—Ç—å video.mp4 –ø–æ–≤–µ—Ä—Ö

–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò
‚úÖ 1024px —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ: 72s (vs 174s —Å 1920px)
‚úÖ MD5 –∫–µ—à: 1s –ø–æ–≤—Ç–æ—Ä–Ω–æ (vs 72s –±–µ–∑ –∫–µ—à–∞)
‚úÖ pg-boss retry: 3 –ø–æ–ø—ã—Ç–∫–∏ —Å backoff
‚úÖ Border enhancement: +5x —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
‚úÖ Worker threads: 2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

–ë–ï–ó –£–°–¢–ê–ù–û–í–ö–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø!
iOS Safari + Chrome Android + Samsung Internet
```

---

**–ö–û–ù–ï–¶ –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–ò**

–≠—Ç–∞ –ø–æ–ª–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç AR-—Å–µ—Ä–≤–∏—Å PhotoBooks Gallery –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å browser preview —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º.
