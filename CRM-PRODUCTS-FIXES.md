# CRM –¢–æ–≤–∞—Ä—ã - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## üéØ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü—É—Å—Ç–æ–π dropdown –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **–°–∏–º–ø—Ç–æ–º:** –í –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∏—á–µ–≥–æ –Ω–µ –≤–∏–¥–Ω–æ
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `category.name` –æ–±—ä–µ–∫—Ç–∞
- **–§–∞–π–ª:** `client/src/components/admin/managers/ProductsManager.tsx`
- **–°—Ç—Ä–æ–∫–∞:** 412

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–∏–¥–µ–æ
- **–°–∏–º–ø—Ç–æ–º:** –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "Create product" –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –æ–∫–Ω–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
- **–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É `videoUrl` –ø–æ–ª–µ–º –∏ –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º –≤–∏–¥–µ–æ
- **–§–∞–π–ª:** `client/src/components/admin/managers/ProductsManager.tsx`
- **–°—Ç—Ä–æ–∫–∏:** 614-660

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –¢–æ–≤–∞—Ä—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
- **–°–∏–º–ø—Ç–æ–º:** –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è, –Ω–æ —Ç–æ–≤–∞—Ä –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
- **–§–∞–π–ª:** `server/routers/ecommerce-router.ts`
- **–°—Ç—Ä–æ–∫–∏:** 92-132

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤
- **–°–∏–º–ø—Ç–æ–º:** –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É—Ç–µ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- **–§–∞–π–ª:** `client/src/components/ObjectUploader.tsx`

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –†–æ–±–∞—Å—Ç–Ω—ã–π dropdown –∫–∞—Ç–µ–≥–æ—Ä–∏–π
```tsx
// –î–æ–±–∞–≤–∏—Ç—å fallback –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ª—É—á—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
{categories && categories.length > 0 ? (
  categories.map((category) => {
    const categoryName = category.name 
      ? (typeof category.name === 'object' ? category.name.ru : category.name)
      : category.slug || category.id;
    
    return (
      <SelectItem key={category.id} value={category.id}>
        {categoryName}
      </SelectItem>
    );
  })
) : (
  <SelectItem value="no-categories" disabled>
    –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
  </SelectItem>
)}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤–∏–¥–µ–æ
```tsx
// –°–¥–µ–ª–∞—Ç—å –ø–æ–ª–µ videoUrl –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–º
<FormField
  control={productForm.control}
  name="videoUrl"
  render={({ field }) => (
    <FormItem>
      <FormLabel>URL –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –≤–∏–¥–µ–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</FormLabel>
      <FormControl>
        <Input {...field} placeholder="https://example.com/video.mp4" />
      </FormControl>
      <FormDescription>
        –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–∞–π–ª–æ–≤ –Ω–∏–∂–µ
      </FormDescription>
      <FormMessage />
    </FormItem>
  )}
/>
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
router.post('/products', mockAuth, requireAdmin, async (req: any, res) => {
  try {
    console.log('Creating product with data:', JSON.stringify(req.body, null, 2));
    
    const productData = insertProductSchema.parse(req.body);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    if (!productData.categoryId || productData.categoryId === "") {
      return res.status(400).json({ 
        message: "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —Ç–æ–≤–∞—Ä–∞",
        field: "categoryId" 
      });
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const categories = await storage.getCategories();
    const categoryExists = categories.find(c => c.id === productData.categoryId);
    if (!categoryExists) {
      return res.status(400).json({ 
        message: "–í—ã–±—Ä–∞–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç",
        field: "categoryId" 
      });
    }
    
    const product = await storage.createProduct(productData);
    console.log('Product created successfully:', product.id);
    res.status(201).json(product);
  } catch (error) {
    console.error("Detailed error creating product:", error);
    
    if (error.name === 'ZodError') {
      return res.status(400).json({ 
        message: "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö",
        errors: error.errors 
      });
    }
    
    res.status(500).json({ message: "Failed to create product" });
  }
});
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: –ù–∞–¥–µ–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
```tsx
// –î–æ–±–∞–≤–∏—Ç—å fallback –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ª—É—á—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
const handleUpload = async (files: FileList) => {
  if (!files.length) return;

  const fileArray = Array.from(files).slice(0, maxNumberOfFiles);
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ uploading API
  try {
    const testResponse = await fetch('/api/local-upload', {
      method: 'HEAD'
    });
    
    if (!testResponse.ok) {
      throw new Error('Upload API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
    }
  } catch (error) {
    console.error('Upload API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback');
    alert('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–µ URL.');
    return;
  }
  
  // –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏...
};
```

## üìÅ –§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

1. `client/src/components/admin/managers/ProductsManager.tsx` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI
2. `server/routers/ecommerce-router.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è API –≤–∞–ª–∏–¥–∞—Ü–∏–∏  
3. `client/src/components/ObjectUploader.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
4. `server/routers/middleware.ts` - —É–ª—É—á—à–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üöÄ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–µ–ø–ª–æ—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î
2. **–ü–æ—ç—Ç–∞–ø–Ω–æ—Å—Ç—å:** –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
4. **–û—Ç–∫–∞—Ç:** –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö - –±—ã—Å—Ç—Ä—ã–π rollback –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏