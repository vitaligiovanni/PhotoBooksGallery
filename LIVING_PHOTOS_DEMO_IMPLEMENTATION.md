# –ñ–∏–≤—ã–µ –§–æ—Ç–æ - –î–µ–º–æ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### Frontend
1. **–£–¥–∞–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "‚ú® Bring to Life"** –∏–∑ ProductCard
2. **–û–±–Ω–æ–≤–ª—ë–Ω ARAddon**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ" ‚Üí `/living-photos`
3. **–°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/living-photos`**:
   - Hero —Å–µ–∫—Ü–∏—è —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
   - –ë–ª–æ–∫ "–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç" (3 —à–∞–≥–∞)
   - –î–µ–º–æ-—Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è AR (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)
   - –°—Ç–∞—Ç—É—Å—ã: –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí –∫–æ–º–ø–∏–ª—è—Ü–∏—è ‚Üí –≥–æ—Ç–æ–≤–æ —Å —Ç–∞–π–º–µ—Ä–æ–º
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ (24 —á–∞—Å–∞)
   - CTA –∫–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥" –¥–ª—è –∑–∞–∫–∞–∑–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
4. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è**:
   - Desktop: "–ñ–∏–≤—ã–µ —Ñ–æ—Ç–æ" –º–µ–∂–¥—É "–í—ã–ø—É—Å–∫–Ω—ã–µ –∞–ª—å–±–æ–º—ã" –∏ "–†–µ–¥–∞–∫—Ç–æ—Ä"
   - Mobile: –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º –º–µ–Ω—é
   - –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è: RU/HY/EN

### Backend
5. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –ë–î** (`shared/schema.ts`):
   - `isDemo: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)
   - `expiresAt: timestamp` (null –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤)
6. **–ù–æ–≤—ã–π endpoint** `POST /api/ar/create-demo`:
   - –°–æ–∑–¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π AR –ø—Ä–æ–µ–∫—Ç
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è (—Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 24 —á–∞—Å–∞)
   - ID –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `demo-` –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
7. **Endpoint –ø—Ä–æ–¥–ª–µ–Ω–∏—è** `PATCH /api/ar/:id/extend-demo`:
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `hours` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 24)
   - –ü—Ä–æ–¥–ª–µ–≤–∞–µ—Ç –¥–µ–º–æ-–ø—Ä–æ–µ–∫—Ç –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ `expiresAt`
   - –¢–æ–ª—å–∫–æ –¥–ª—è demo-–ø—Ä–æ–µ–∫—Ç–æ–≤

### Admin Panel
8. **–†–∞–∑–¥–µ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫**:
   - –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª–∞–¥–æ–∫: "–í—Å–µ" / "–†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã" / "–î–µ–º–æ (24—á)"
   - –ë–µ–π–¥–∂ "–î–ï–ú–û" —Å –æ—Ä–∞–Ω–∂–µ–≤—ã–º —Ñ–æ–Ω–æ–º
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è
   - –ö–Ω–æ–ø–∫–∞ "+24—á" –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ (—Ç–æ–ª—å–∫–æ —É demo)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
9. **–§–∏–∫—Å ENOENT** –≤ `create-with-product`: 
   - –ò–∑–º–µ–Ω–µ–Ω—ã –ø—É—Ç–∏ —Å `/api/ar/storage/...` –Ω–∞ `objects/ar-storage/...`
10. **–§–∏–∫—Å —è–∑—ã–∫–∞** –≤ `CreateARSimple.tsx`:
    - –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `i18n.language` –≤–º–µ—Å—Ç–æ localStorage

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

–í—ã–ø–æ–ª–Ω–∏—Ç—å SQL:
```sql
ALTER TABLE ar_projects ADD COLUMN IF NOT EXISTS is_demo BOOLEAN DEFAULT FALSE;
ALTER TABLE ar_projects ADD COLUMN IF NOT EXISTS expires_at TIMESTAMP WITH TIME ZONE;
CREATE INDEX IF NOT EXISTS IDX_ar_projects_is_demo ON ar_projects(is_demo);
CREATE INDEX IF NOT EXISTS IDX_ar_projects_expires_at ON ar_projects(expires_at) WHERE expires_at IS NOT NULL;
```

–ò–ª–∏:
```bash
psql -U postgres -d photobooksgallery -f backend/migrations/add_demo_fields_to_ar_projects.sql
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [ ] Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] Frontend –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω (`npm run build` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ñ–∏–≤—ã–µ —Ñ–æ—Ç–æ"
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/living-photos` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- [ ] –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ñ–æ—Ç–æ + –≤–∏–¥–µ–æ)
- [ ] –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (—Å—Ç–∞—Ç—É—Å pending ‚Üí processing ‚Üí ready)
- [ ] QR-–∫–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
- [ ] –¢–∞–π–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
- [ ] –°—Å—ã–ª–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥" —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Admin `/admin/ar` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∫–ª–∞–¥–∫–∏
- [ ] Demo-–ø—Ä–æ–µ–∫—Ç—ã –ø–æ–º–µ—á–µ–Ω—ã –æ—Ä–∞–Ω–∂–µ–≤—ã–º –±–µ–π–¥–∂–µ–º
- [ ] –ö–Ω–æ–ø–∫–∞ "+24—á" –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç —Å—Ä–æ–∫

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç—ë–∫—à–∏—Ö –¥–µ–º–æ
–°–æ–∑–¥–∞—Ç—å cron-–∑–∞–¥–∞—á—É –∏–ª–∏ scheduled job:
```typescript
// backend/src/jobs/cleanup-expired-demos.ts
import { db } from '../db';
import { arProjects } from '@shared/schema';
import { and, eq, lt } from 'drizzle-orm';
import fs from 'fs/promises';
import path from 'path';

export async function cleanupExpiredDemos() {
  const now = new Date();
  
  // –ù–∞–π—Ç–∏ –∏—Å—Ç—ë–∫—à–∏–µ demo-–ø—Ä–æ–µ–∫—Ç—ã
  const expired = await db.select()
    .from(arProjects)
    .where(
      and(
        eq(arProjects.isDemo, true),
        lt(arProjects.expiresAt, now)
      )
    );

  for (const project of expired) {
    console.log(`Deleting expired demo: ${project.id}`);
    
    // –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã
    const storageDir = path.join(process.cwd(), 'objects', 'ar-storage', project.id);
    await fs.rm(storageDir, { recursive: true, force: true }).catch(() => {});
    
    // –£–¥–∞–ª–∏—Ç—å –∏–∑ –ë–î
    await db.delete(arProjects).where(eq(arProjects.id, project.id));
  }

  console.log(`Cleaned up ${expired.length} expired demos`);
}

// –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
setInterval(cleanupExpiredDemos, 6 * 60 * 60 * 1000);
```

### 2. Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Nodemailer/SendGrid:
```typescript
// –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å email:
// "–í–∞—à–∞ –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è –∂–∏–≤–æ–≥–æ —Ñ–æ—Ç–æ –∏—Å—Ç–µ–∫–ª–∞. 
//  –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é, –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑: [—Å—Å—ã–ª–∫–∞]"
```

### 3. –ö–æ–Ω–≤–µ—Ä—Å–∏—è –¥–µ–º–æ ‚Üí –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ
Endpoint `POST /api/ar/:id/convert-to-permanent`:
- –°–Ω–∏–º–∞–µ—Ç —Ñ–ª–∞–≥ `isDemo`
- –û—á–∏—â–∞–µ—Ç `expiresAt`
- –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∫ –∑–∞–∫–∞–∑—É/–ø—Ä–æ–¥—É–∫—Ç—É
- –ù–∞—á–∏—Å–ª—è–µ—Ç –æ–ø–ª–∞—Ç—É

### 4. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
- –°–∫–æ–ª—å–∫–æ –¥–µ–º–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –¥–µ–Ω—å
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è (–¥–µ–º–æ ‚Üí –∑–∞–∫–∞–∑)
- –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–º–æ –¥–æ –ø–æ–∫—É–ø–∫–∏

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Demo endpoints –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º (`requireAuth`)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `is_demo` –∏ `expires_at` —É—Å–∫–æ—Ä—è—é—Ç –≤—ã–±–æ—Ä–∫—É
- **UX**: 24 —á–∞—Å–∞ ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞, –Ω–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–∏ —Ä–æ—Å—Ç–µ demo-–ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ `expires_at`

## üéØ –ò—Ç–æ–≥–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–Ω–æ–ø–∫–∞ "–û–∂–∏–≤–∏—Ç—å" –ø—É—Ç–∞–ª–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤, –Ω–µ –±—ã–ª–æ –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±—Ä–∞–ª–∏ –æ—Ç–≤–ª–µ–∫–∞—é—â—É—é –∫–Ω–æ–ø–∫—É
2. –°–æ–∑–¥–∞–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é –ª–µ–Ω–¥–∏–Ω–≥-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
3. –†–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–µ–º–æ-–ø—Ä–æ–µ–∫—Ç—ã (24—á)
4. –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ä–æ–∫–∞–º–∏ –¥–µ–º–æ
5. –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è ‚Äî CTA –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –≤–æ—Ä–æ–Ω–∫–∞: —É–∑–Ω–∞—Ç—å ‚Üí –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ ‚Üí –∫—É–ø–∏—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é.
