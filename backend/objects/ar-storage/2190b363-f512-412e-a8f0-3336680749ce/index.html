<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>PhotoBooks Gallery AR - 2190b363-f512-412e-a8f0-3336680749ce</title>
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
<style>
body,html{margin:0;padding:0;width:100%;height:100%;overflow:hidden}
.arjs-loader{position:absolute;inset:0;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;z-index:9999;transition:opacity .6s;font-family:system-ui,-apple-system,sans-serif}
.arjs-loader.hidden{opacity:0;pointer-events:none}
.spinner{width:56px;height:56px;border:5px solid #ffffff40;border-top-color:#fff;border-radius:50%;animation:s 1s linear infinite;margin-bottom:24px}
@keyframes s{to{transform:rotate(360deg)}}
#instructions{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.65);color:#fff;padding:16px 32px;border-radius:40px;backdrop-filter:blur(12px);font-size:16px;font-weight:600;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,0.4)}
#instructions::before{content:"üì∏";margin-right:10px;font-size:20px}
</style>
</head>
<body>
<div class="arjs-loader" id="loading"><div class="spinner"></div><h2>–ó–∞–≥—Ä—É–∑–∫–∞ AR‚Ä¶</h2><p>–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</p></div>
<div id="instructions">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</div>
<a-scene embedded mindar-image="imageTargetSrc:./marker.mind?t=1763791775760;maxTrack:1;filterMinCF:0.0001;filterBeta:0.001;warmupTolerance:5;missTolerance:5" color-space="sRGB" renderer="colorManagement:true;antialias:true;alpha:true" vr-mode-ui="enabled:false" device-orientation-permission-ui="enabled:false">
<a-assets timeout="30000"><video id="vid" src="./video.mp4?t=1763791775760" preload="auto" loop muted playsinline crossorigin="anonymous"></video></a-assets>
<a-camera position="0 0 0" look-controls="enabled:false" cursor="rayOrigin:mouse"></a-camera>
<a-entity mindar-image-target="targetIndex:0"><a-plane id="plane" rotation="0 0 0" width="1" height="1" position="0 0 0" material="src:#vid;shader:flat;transparent:true;opacity:0;side:double" visible="false" animation__fade="property:material.opacity;from:0;to:1;dur:500;startEvents:showvid;easing:easeInOutQuad"></a-plane></a-entity>
</a-scene>
<script>
console.log('[AR] Page loaded');
setTimeout(()=>{console.log('[AR] Failsafe: hiding loader after 5s');document.getElementById('loading').classList.add('hidden')},5000);
const video=document.getElementById('vid');
const plane=document.getElementById('plane');
const loading=document.getElementById('loading');
const target=document.querySelector('[mindar-image-target]');
console.log('[AR] Elements found:',{video:!!video,plane:!!plane,loading:!!loading,target:!!target});
let r={v:false,t:false,m:false};
let markerActive=false;
let videoReady=false;
video.addEventListener('canplay',()=>{if(videoReady)return;videoReady=true;console.log('[AR] ‚úì Video canplay, marking ready');r.v=true;if(/Android/i.test(navigator.userAgent)){setTimeout(()=>{console.log('[AR] ‚úì Texture warmed (Android)');r.t=true;check()},450)}else{r.t=true;check()}});
target.addEventListener('targetFound',()=>{if(markerActive){console.log('[AR] Marker re-found (ignored)');return}console.log('[AR] ‚úì‚úì‚úì MARKER FOUND! ‚úì‚úì‚úì');r.m=true;check()});
const scene=document.querySelector('a-scene');
scene.addEventListener('arReady',()=>{console.log('[AR] ‚úì MindAR ready, camera started');setTimeout(()=>loading.classList.add('hidden'),300)});
scene.addEventListener('arError',(e)=>{console.error('[AR] ‚ùå MindAR Error:',e);loading.innerHTML='<h2>–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞</h2><p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–º–µ—Ä—É</p>'});
console.log('[AR] Listeners attached, waiting for events...');
function check(){console.log('[AR] Check state:',JSON.stringify(r),'markerActive:',markerActive);if(markerActive)return;if(r.v&&r.t&&r.m){markerActive=true;console.log('[AR] üé¨ ALL READY! Playing video...');video.muted=false;video.currentTime=0;const playPromise=video.play();if(playPromise){playPromise.then(()=>{console.log('[AR] ‚úì Video playing');setTimeout(()=>{plane.setAttribute('visible','true');plane.emit('showvid');console.log('[AR] ‚úì Plane visible')},200)}).catch(e=>{console.warn('[AR] Play failed, trying muted:',e);video.muted=true;video.play().then(()=>{setTimeout(()=>{plane.setAttribute('visible','true');plane.emit('showvid')},200)})})}}else{console.log('[AR] ‚è≥ Waiting for:',!r.v?'video':'',!r.t?'texture':'',!r.m?'marker':'')}}
target.addEventListener('targetLost',()=>{console.log('[AR] Marker lost');markerActive=false;plane.setAttribute('visible','false');plane.setAttribute('material','opacity',0);video.pause();video.currentTime=0});
</script>
</body>
</html>