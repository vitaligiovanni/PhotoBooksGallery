<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>PhotoBooks Gallery AR - 2d4b3fa6-6e4f-45d0-bb21-57a502c3c0b3 (2 photos)</title>
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
<style>
body,html{margin:0;padding:0;width:100%;height:100%;overflow:hidden}
.arjs-loader{position:fixed;inset:0;background:#ffffff;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#333;z-index:9999;transition:opacity .6s;font-family:system-ui,-apple-system,sans-serif}
.arjs-loader.hidden{opacity:0;pointer-events:none}
.loading-text{font-size:20px;font-weight:600;color:#667eea;text-align:center;padding:0 20px}
#instructions{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.75);color:#fff;padding:16px 32px;border-radius:40px;font-size:16px;font-weight:600;z-index:100}
#marker-counter{position:fixed;top:20px;right:20px;background:rgba(0,0,0,0.75);color:#fff;padding:12px 20px;border-radius:20px;font-size:18px;font-weight:600;z-index:101}
</style>
</head>
<body>
<div class="arjs-loader" id="loading">
  <div style="font-size:64px;margin-bottom:20px">üì∏</div>
  <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ AR —Å 2 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏...</div>
</div>
<div id="instructions">–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∏–∑ –∞–ª—å–±–æ–º–∞</div>
<div id="marker-counter">–ù–∞–π–¥–µ–Ω–æ: <span id="found-count">0</span>/2</div>

<a-scene embedded 
  mindar-image="imageTargetSrc:./marker.mind?t=1764145472245;maxTrack:2;filterMinCF:0.0001;filterBeta:0.003;warmupTolerance:5;missTolerance:10" 
  color-space="sRGB" 
  renderer="colorManagement:true;antialias:true;alpha:true" 
  vr-mode-ui="enabled:false" 
  device-orientation-permission-ui="enabled:false">
  
  <a-assets timeout="30000">
    <video id="vid0" src="./video-0.mp4?t=1764145472245" preload="auto" loop muted playsinline crossorigin="anonymous"></video>
    <video id="vid1" src="./video-1.mp4?t=1764145472245" preload="auto" loop muted playsinline crossorigin="anonymous"></video>
  </a-assets>
  
  <a-camera position="0 0 0" look-controls="enabled:false" cursor="rayOrigin:mouse"></a-camera>
  
  
<a-entity mindar-image-target="targetIndex:0">
  <a-plane id="plane0" 
    rotation="0 0 0" 
    width="1" 
    height="1.499267935578331" 
    position="0 0 0" 
    material="src:#vid0;shader:flat;transparent:true;opacity:0;side:double" 
    visible="false" 
    animation__fade="property:material.opacity;from:0;to:1;dur:500;startEvents:showvid0;easing:easeInOutQuad">
  </a-plane>
</a-entity>

<a-entity mindar-image-target="targetIndex:1">
  <a-plane id="plane1" 
    rotation="0 0 0" 
    width="1" 
    height="1" 
    position="0 0 0" 
    material="src:#vid1;shader:flat;transparent:true;opacity:0;side:double" 
    visible="false" 
    animation__fade="property:material.opacity;from:0;to:1;dur:500;startEvents:showvid1;easing:easeInOutQuad">
  </a-plane>
</a-entity>
  
</a-scene>

<script>
console.log('[AR Multi-Target] 2 markers loaded');
const loading = document.getElementById('loading');
const foundCount = document.getElementById('found-count');
const markerStates = Array(2).fill(false);
let foundMarkers = 0;

// Setup all videos and planes

const video0 = document.getElementById('vid0');
const plane0 = document.getElementById('plane0');
const target0 = document.querySelectorAll('[mindar-image-target]')[0];

video0.load();
video0.addEventListener('canplay', () => console.log('[AR] Video 0 ready'));

target0.addEventListener('targetFound', () => {
  console.log('[AR] ‚úì Marker 0 found!');
  if (!markerStates[0]) {
    markerStates[0] = true;
    foundMarkers++;
    foundCount.textContent = foundMarkers;
  }
  video0.currentTime = 0;
  video0.muted = true;
  video0.play().then(() => {
    plane0.setAttribute('visible', 'true');
    plane0.emit('showvid0');
    setTimeout(() => video0.muted = false, 800);
  });
});

target0.addEventListener('targetLost', () => {
  console.log('[AR] Marker 0 lost');
  plane0.setAttribute('visible', 'false');
  video0.pause();
  video0.currentTime = 0;
});


const video1 = document.getElementById('vid1');
const plane1 = document.getElementById('plane1');
const target1 = document.querySelectorAll('[mindar-image-target]')[1];

video1.load();
video1.addEventListener('canplay', () => console.log('[AR] Video 1 ready'));

target1.addEventListener('targetFound', () => {
  console.log('[AR] ‚úì Marker 1 found!');
  if (!markerStates[1]) {
    markerStates[1] = true;
    foundMarkers++;
    foundCount.textContent = foundMarkers;
  }
  video1.currentTime = 0;
  video1.muted = true;
  video1.play().then(() => {
    plane1.setAttribute('visible', 'true');
    plane1.emit('showvid1');
    setTimeout(() => video1.muted = false, 800);
  });
});

target1.addEventListener('targetLost', () => {
  console.log('[AR] Marker 1 lost');
  plane1.setAttribute('visible', 'false');
  video1.pause();
  video1.currentTime = 0;
});


const scene = document.querySelector('a-scene');
scene.addEventListener('arReady', () => {
  console.log('[AR] MindAR ready with 2 markers');
  setTimeout(() => loading.classList.add('hidden'), 300);
});
scene.addEventListener('arError', (e) => {
  console.error('[AR] Error:', e);
  loading.innerHTML = '<h2>–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã</h2>';
});
</script>
</body>
</html>