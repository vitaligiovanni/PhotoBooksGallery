<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AR Viewer - manual-test</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #loading { position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; background:#111; color:#fff; font-family:sans-serif }
    #loading.hidden { display:none }
    #hint { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,.7); color:#fff; padding:10px 14px; border-radius:20px; font-size:14px; font-family: sans-serif }
  </style>
</head>
<body>
  <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ AR...</div>
  <div id="hint">üì∏ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</div>
  <a-scene mindar-image="imageTargetSrc: ./marker.mind; maxTrack: 1; filterMinCF:0.00001; filterBeta: 0.001; warmupTolerance: 10; missTolerance: 10" color-space="sRGB" renderer="colorManagement:true, physicallyCorrectLights" vr-mode-ui="enabled:false" device-orientation-permission-ui="enabled:false">
    <a-assets>
      <video id="ar-video" src="./video.mp4" preload="auto" loop autoplay playsinline webkit-playsinline crossorigin="anonymous"></video>
    </a-assets>
    <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>
    <a-entity mindar-image-target="targetIndex: 0">
      <a-video src="#ar-video" position="0 0 0" rotation="0 0 0" width="1" height="0.75"></a-video>
    </a-entity>
  </a-scene>
  <script>
    const sceneEl = document.querySelector('a-scene');
    const loading = document.getElementById('loading');
    const hint = document.getElementById('hint');
    
    // Hide loading when ready
    sceneEl.addEventListener('loaded', () => {
      loading.classList.add('hidden');
      console.log('AR Scene loaded!');
    });
    
    // Debug: track MindAR initialization
    sceneEl.addEventListener('renderstart', () => {
      console.log('AR rendering started');
    });
    
    // Track marker detection
    const targetEl = document.querySelector('[mindar-image-target]');
    if (targetEl) {
      targetEl.addEventListener('targetFound', () => {
        console.log('‚úÖ MARKER FOUND!');
        hint.textContent = '‚úÖ –ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω!';
        hint.style.background = 'rgba(0,200,0,.8)';
        
        // Ensure video plays
        const video = document.getElementById('ar-video');
        if (video) {
          video.play().catch(e => console.warn('Video play failed:', e));
        }
      });
      
      targetEl.addEventListener('targetLost', () => {
        console.log('‚ùå Marker lost');
        hint.textContent = 'üì∏ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é';
        hint.style.background = 'rgba(0,0,0,.7)';
      });
    }
    
    // Detect any errors
    window.addEventListener('error', (e) => {
      console.error('Error:', e.message, e.filename, e.lineno);
      hint.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + e.message;
      hint.style.background = 'rgba(200,0,0,.8)';
    });
  </script>
</body>
</html>