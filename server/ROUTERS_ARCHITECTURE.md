# Модульная архитектура роутеров PhotoBooksGallery

## Обзор

Файл `server/routes.ts` был реорганизован из монолитной структуры (1375 строк) в модульную архитектуру с 6 специализированными роутерами.

## Структура модульных роутеров

### 1. `health-router.ts`
**Назначение:** Health checks и базовая аутентификация
**Маршруты:**
- `GET /api/health/db` - проверка подключения к БД
- `GET /api/auth/user` - информация о пользователе (mock для разработки)

### 2. `file-router.ts` 
**Назначение:** Загрузка и обслуживание файлов
**Маршруты:**
- `GET /api/local-upload/:uuid` - поиск файлов по UUID
- `POST /api/upload/formidable` - загрузка через formidable
- `POST /api/local-upload` - загрузка через multer
- `GET /api/uploads/:fileName` - обслуживание локальных файлов
- `POST /api/objects/upload` - получение URL для загрузки
- `POST /api/objects/normalize` - нормализация путей

### 3. `ecommerce-router.ts`
**Назначение:** Управление электронной коммерцией
**Маршруты:**
- Категории: `GET/POST/PUT/DELETE /api/categories`
- Товары: `GET/POST/PUT/DELETE /api/products`, поиск, управление ценами
- Заказы: `GET/POST/PUT /api/orders`

### 4. `content-router.ts`
**Назначение:** Управление контентом (блог, комментарии)
**Маршруты:**
- Категории блога: `GET/POST /api/blog-categories`
- Посты блога: `GET/POST/PUT/DELETE /api/blog-posts`
- Комментарии: `GET/POST /api/comments`
- Публичный API блога: `GET /api/blog/posts`, `GET /api/blog/categories`

### 5. `settings-router.ts`
**Назначение:** Настройки, темы и отзывы
**Маршруты:**
- Настройки: `GET/PUT /api/settings`
- Темы пользователей: `GET/PUT /api/user/theme`
- Отзывы: `GET/POST/PUT/DELETE /api/reviews`, админское управление

### 6. `finance-router.ts`
**Назначение:** Управление валютами и курсами обмена
**Маршруты:**
- Валюты: `GET/POST /api/currencies`
- Курсы обмена: `GET/POST/PUT /api/exchange-rates`
- Базовая валюта: `GET/PUT /api/currencies/base`

## Middleware

### `middleware.ts`
Централизованные middleware функции:
- `mockAuth` - имитация аутентификации для разработки
- `requireAdmin` - проверка прав администратора
- `requireAuth` - проверка аутентификации

## Преимущества новой архитектуры

1. **Модульность** - каждый роутер отвечает за свою предметную область
2. **Поддерживаемость** - легче находить и изменять код
3. **Тестируемость** - роутеры можно тестировать изолированно
4. **Масштабируемость** - легко добавлять новые функциональные модули
5. **Читаемость** - код организован логически

## Порядок подключения роутеров

В основном файле `routes.ts`:
1. Создаются экземпляры всех роутеров
2. Применяется глобальный middleware аутентификации
3. Подключаются роутеры с префиксом `/api`

## Миграция с монолитной структуры

Старый монолитный файл был разделен на логические модули:
- Удалено 1200+ строк кода из основного файла
- Сохранена полная обратная совместимость API
- Все middleware централизованы в одном месте
- Упрощена система проверки прав доступа

## Рекомендации по разработке

1. **Новые маршруты** добавлять в соответствующий модульный роутер
2. **Общие middleware** добавлять в `middleware.ts`
3. **Тестирование** проводить для каждого роутера отдельно
4. **Документирование** обновлять при изменении API